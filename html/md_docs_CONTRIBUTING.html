<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sly Cooper Decompilation: Contributing Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Sly Cooper Decompilation
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_docs_CONTRIBUTING.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Contributing Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md2"></a>
So you want to decompile Sly 1...</h1>
<p>You've come to the right place! We welcome new contributors of all skill levels. Even if you've never tried game hacking, modding, or reverse-engineering, we have a dedicated community of modders and reverse-engineers to help you get started. Feel feel to join our <a href="https://discord.gg/2GSXcEzPJA">Discord server</a> and ask for help in #sly-research.</p>
<p>This guide will help you start contributing to the project. This is a 100% volunteer-driven project, all contributions are greatly appreciated. The current goal is to decompile and match as many game functions as possible, while imitating the style and structure of the original code to understand the inner workings of the game engine.</p>
<p>By following this guide, you will learn how to fork the repo on GitHub, choose a function to reverse-engineer, write code to match it, and integrate that code into the project. Once you've done that, and your pull request is merged, you will get the Decomp Contributor role in the Discord Server.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Contents</h1>
<ol type="1">
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#find-a-function-to-match">Find a function to match</a></li>
<li><a href="#match-the-function-using-decompme">Match the function using Decomp.me</a></li>
<li><a href="#integrate-the-matched-code">Integrate the matched code</a></li>
<li><a href="#make-a-pull-request">Make a Pull Request</a></li>
</ol>
<ol type="1">
<li><a href="#conclusion">Conclusion</a></li>
</ol>
<h2><a class="anchor" id="autotoc_md4"></a>
Getting started</h2>
<p>If you haven't used Git before, follow the <a class="el" href="BEGINNERSGUIDE_8md.html">Beginner's Guide</a> to learn how to fork the repo, make changes, and submit a pull request when you're done. If you're already familiar with Git, continue on with this guide.</p>
<p>First, follow the instructions in the <a class="el" href="README_8md.html">README</a> to build the project. If you see the following in the terminal, you're ready to start contributing:</p>
<div class="fragment"><div class="line">[XXX/XXX] sha1sum config/checksum.sha1</div>
<div class="line">out/SCUS_971.98: OK</div>
</div><!-- fragment --><p>The goal of this project is to match the original code closely enough that it compiles to a byte-matching executable. This means writing functions that compiles to the same assembly as the original functions. You will know it matches if you build the project and it says <code>SCUS_971.98: OK</code> with no errors.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Find a function to match</h2>
<p>First, find a function in the game that you want to match. There are a few ways to do this:</p><ul>
<li>Browse Ghidra for interesting functions.</li>
<li>Look through the <code>src</code> directory to find functions in <code>.c</code> files that haven't been matched yet.<ul>
<li>Functions that haven't been matched will have an <code>INCLUDE_ASM</code> macro as as placeholder.</li>
</ul>
</li>
<li>Look through the <code>asm/nonmatchings</code> folder.</li>
<li>Ask for suggestions on Discord.</li>
</ul>
<h2><a class="anchor" id="autotoc_md6"></a>
Match the function using Decomp.me</h2>
<p>Once you have chosen a function, you can use the website <a href="https://decomp.me/">decomp.me</a> to match it.</p><ol type="1">
<li>Go the website and click "Start decomping".</li>
<li>Click "PS2", then under "Preset", select "Sly Cooper and the Thievius Raccoonus".</li>
<li>Under "Diff label", enter the name of the function.</li>
<li>Find the <code>.s</code> file corresponding to the function you want to match in the <code>asm/nonmatchings</code> directory. Copy the contents of the file into the "Target assembly" box.</li>
<li>Copy any functions, global variables, or data types used by the function from the headers in the <code>include</code> directory into the "Context" box.<ul>
<li>E.g. For the function <code>void <a class="el" href="clock_8h.html#a374128d3628fad7a947557821a975524" title="Resets the clock to the given time t.">ResetClock(struct CLOCK* pclock, float t)</a></code>, you will need to include the definition of <code><a class="el" href="structCLOCK.html" title="Engine clock.">CLOCK</a></code> struct, and the <code>TICK</code> data type since it is used in the <a class="el" href="structCLOCK.html" title="Engine clock.">CLOCK</a> struct.</li>
<li>You should almost always copy the entirety of "types.h" to ensure you have all the necessary primitive types.</li>
</ul>
</li>
<li>Click "Create scratch".</li>
<li>**(Recommended)** Go to the "Options" tab and under "Debug information" select <code>-g3 (Macro expansions)</code>. This will show you which line numbers the source code correspond to each line in the assembly.</li>
</ol>
<p>Then start writing your code under the "Source code" tab. It will tell you what percent of the code matches the original. Tweak the code until it matches 100%. An example scratch can be found here: <a href="https://decomp.me/scratch/hmmyP">https://decomp.me/scratch/hmmyP</a></p>
<p><em>Note: You can use the code in the <code>reference</code> directory to help you during matching. The code in that directory does not match, but it may be useful as an outline for certain functions.</em></p>
<h2><a class="anchor" id="autotoc_md7"></a>
Integrate the matched code</h2>
<p>Once the function matches 100%, follow these steps to integrate it into the project:</p><ol type="1">
<li>Replace the <code>INCLUDE_ASM</code> macro in the <code>.c</code> file with the matched function.<ul>
<li>If the function is in a new file, <b>do not create a new file</b>. Creating new <code>.c</code> files is done by editing the <code>config/sly1.yaml</code> file to change the file split from <code>asm</code> to <code>c</code>, then running <code>python configure.py</code> to generate the new file. If you don't know how to do this, feel free to ask for help in the Discord server.</li>
</ul>
</li>
<li>Check <code>config/symbol_addrs.txt</code> to see if the mangled name of the function is present.<ul>
<li>If it is not, add the <b>mangled name</b> of the function with it's address. The mangled name of the function can be found in the debug symbols for the May 2002 prototype. If you don't know how to find it, ask for help in the Discord server; someone will be able to find it for you easily.</li>
<li>The symbol_addrs.txt file is grouped alphabetically by filename, then sorted by address within the file.</li>
</ul>
</li>
</ol>
<p>The project should build and match. Here are some common troubleshooting tips:</p><ul>
<li><code>undefined reference error</code> usually means the entry in the symbol_addrs.txt is wrong. Make sure the function name is mangled in symbol_addrs.txt and unmangled in the source code, and the mangled version matches the signature of the function. Also ensure that the address is correct in symbol_addrs.txt.</li>
<li><code>checksum failed</code> means the compiled elf with your added code doesn't match the original. If it matches on decomp.me but not in the project, it might be an issue with the compiler, so open an issue on GitHub or let someone know on Discord.</li>
</ul>
<h2><a class="anchor" id="autotoc_md8"></a>
Make a pull request</h2>
<p>Once you add your code to the project and it builds + matches, you can open a pull request to merge your fork into the main branch of the project. A code reviewer will need to approve it before it can be merged into the main branch.</p>
<p>We are a volunteer-driven project, so please be patient while we review your code. These are the main things we will look for in your code:</p><ul>
<li>It compiles without any errors.</li>
<li>The compiled elf matches the original elf.</li>
</ul>
<p>If everything looks good, we will merge your pull request as soon as possible. If anything needs to be addressd, we will let you know.</p>
<h2><a class="anchor" id="autotoc_md9"></a>
Conclusion</h2>
<p>Thank you for reading, and we appreciate any contributions you make to the project! The project is 100% volunteern-driven, so perfection is not required. The most important thing is to have fun and learn something new about the game.</p>
<p>If you have any questions or concerns, feel free to ask in the <a href="https://discord.gg/2Y8b8Z2">Discord server</a> or <a href="https://github.com/TheOnlyZac/sly1/issues/new">open an issue</a> on GitHub. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
