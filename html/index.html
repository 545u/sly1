<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Sly Cooper Decompilation: Sly Cooper and the Thievius Raccoonus</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Sly Cooper Decompilation
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Sly Cooper and the Thievius Raccoonus </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://github.com/TheOnlyZac/sly1/actions/workflows/build.yml"><img src="https://img.shields.io/github/actions/workflow/status/theonlyzac/sly1/build.yml?branch=main&amp;label=build" alt="Build" class="inline"/></a> <img src="https://img.shields.io/endpoint?label=progress&amp;url=https%3A%2F%2Fprogress.deco.mp%2Fdata%2Fslycooper1%2Fus%2Fall%2F%3Fmode%3Dshield%26measure%3DP2" alt="code-progress-badge" class="inline"/> <a href="https://github.com/theonlyzac/sly1/graphs/contributors"><img src="https://img.shields.io/github/contributors/theonlyzac/sly1?color=%23db6d28" alt="Contributors" class="inline"/></a> <a href="https://discord.gg/2GSXcEzPJA"><img src="https://img.shields.io/discord/439454661100175380?color=%235865F2&amp;logo=discord&amp;logoColor=%23FFFFFF" alt="Discord Channel" class="inline"/></a> <a href="https://theonlyzac.github.io/sly1"><img src="https://img.shields.io/badge/docs-github.io-2C4AA8" alt="Docs" class="inline"/></a> <a href="https://slymods.info"><img src="https://img.shields.io/badge/wiki-slymods.info-2C4AA8" alt="Wiki" class="inline"/></a></p>
<p><a href="https://theonlyzac.github.io/sly1"><img src="logo.png" alt="Sly 1 Decompilation Logo by Cooper941" style="margin:7px" align="right" width="33%" class="inline"/></a></p>
<p>This is a work-in-progress decompilation of <a href="https://en.wikipedia.org/wiki/Sly_Cooper_and_the_Thievius_Raccoonus"><em>Sly Cooper and the Thievius Raccoonus</em></a> for the PlayStation 2. It builds the NTSC-U version of the game, <code>SCUS_971.98</code> (SHA1: <code>57dc305d</code>).</p>
<p>The goal of this project is to better understand the game engine. This repo does not contain any game assets or code from the game's executable; It requires your own copy of the game to build and run.</p>
<p>Documentation of the code can be found at <a href="https://theonlyzac.github.io/sly1">theonlyzac.github.io/sly1</a>. For further reading on the game's internal structures and mechanics, visit the <a href="https://slymods.info">SlyMods Wiki</a>.</p>
<p>New contributors are welcome and encouraged to make a pull request! If you would like to help but aren't sure where to start, check out <a class="el" href="CONTRIBUTING_8md.html">CONTRIBUTING.md</a> and feel free to <a href="https://discord.gg/2GSXcEzPJA">join our Discord server</a> for guidance.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Quickstart</h1>
<p><b>1. Setup build environment.</b></p>
<p>Copy and paste this into your terminal:</p>
<div class="fragment"><div class="line">git clone https://github.com/theonlyzac/sly1 &amp;&amp; \</div>
<div class="line">cd sly1 &amp;&amp; \</div>
<div class="line">pip install -U -r requirements.txt &amp;&amp; \</div>
<div class="line">sudo ./scripts/setup_build_environment.sh</div>
</div><!-- fragment --><p><b>2. Extract your original ELF file.</b></p>
<p>Copy the file <code>SCUS_971.98</code> from your Sly 1 game disc to the <code>disc</code> directory of the project.</p>
<p><b>3. Build the project.</b></p>
<p>Run the build script with this command:</p>
<div class="fragment"><div class="line">./scripts/build.sh</div>
</div><!-- fragment --><p>If it works, you will see this: </p><div class="fragment"><div class="line">[XXX/XXX] sha1sum checksum.sha1</div>
<div class="line">out/SCUS_971.98: OK</div>
</div><!-- fragment --><p>If you have any issues, or you prefer to set up the project manually, follow the instructions below. Instructions to run the game are also provided below.</p>
<h1><a class="anchor" id="autotoc_md22"></a>
Manual Setup</h1>
<p>The project can be built on Linux (or Windows using WSL). Follow the instructions below to set up the build environment.</p>
<h2><a class="anchor" id="autotoc_md23"></a>
Clone the repository</h2>
<p>Clone the repo to your local machine:</p>
<div class="fragment"><div class="line">git clone https://github.com/TheOnlyZac/sly1</div>
<div class="line">cd sly1</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md24"></a>
Extract your original ELF file</h2>
<p>To build the project, you will need to extract the original ELF file from your own legally obtained copy of the game. Mount the disc on your PC and copy the file <code>SCUS_971.98</code> from your disc to the <code>disc</code> directory of this project.</p>
<h2><a class="anchor" id="autotoc_md25"></a>
Install python packages</h2>
<p>You will need Python 3.8 or higher.</p>
<div class="fragment"><div class="line">pip install -U -r requirements.txt</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md26"></a>
Setup build environment</h2>
<ol type="1">
<li>Setup wine: <div class="fragment"><div class="line">sudo dpkg --add-architecture i386</div>
<div class="line">sudo apt-get update</div>
<div class="line">sudo apt-get install wine32</div>
</div><!-- fragment --></li>
<li>Install MIPS assembler: <div class="fragment"><div class="line">sudo apt-get install binutils-mips-linux-gnu</div>
</div><!-- fragment --></li>
<li>Setup compiler: <div class="fragment"><div class="line">cd scripts</div>
<div class="line">./setup-progd-linux.sh</div>
</div><!-- fragment --></li>
</ol>
<p>### Build the project</p>
<p>The project builds the executable `SCUS_971.98`.</p>
<p>```bash python configure.py ninja </p>
<p>If you update any config files or add any source files, you will need run a clean reconfigure:</p>
<div class="fragment"><div class="line">python configure.py --clean</div>
</div><!-- fragment --><p>To only clean without reconfiguring (i.e. delete build files) use:</p>
<div class="fragment"><div class="line">python configure.py --only-clean</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md27"></a>
Running</h1>
<p>Running the executable requires <a href="https://pcsx2.net/">PCSX2 2.0</a>. You must have your own copy of the original game and the BIOS from your own PS2. They are not included in this repo and we cannot provide them for you.</p>
<p>Once you have those and you have built the executable, you can run it in one of three ways:</p>
<h2><a class="anchor" id="autotoc_md28"></a>
1. Autorun script</h2>
<p>The <code>run.sh</code> script in the <code>scripts</code> dir will automatically rebuild the executable and run it in the PCSX2 emulator. To use it, you must first edit the script to set the <code>PCSX2_PATH</code> and <code>ISO_PATH</code> variables to the correct paths on your system.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
2. Run from command line</h2>
<p>To boot the elf in PCSX2 from the command line, use the following command:</p>
<div class="fragment"><div class="line">pcsx2.exe -elf &quot;.../sly1/bin/debug/SCUS_971.98&quot; &quot;/path/to/game/backup.iso&quot;</div>
</div><!-- fragment --><p>Replace <code>pcsx2.exe</code> with the path to your PCSX2 v2.0 executable (for Linux it will be an **.appimage** file).</p><ul>
<li>The <code>-elf</code> parameter specifies the path to the SCUS_971.98 you built from this project. Replace <code>...</code> with the path to this repository. The emulator will use this ELF to boot the game.</li>
<li>The last argument is the path to your game ISO. Replace <code>/path/to/game/backup.iso</code> with the path to a backup of your own game disc. This is where the game will load the assets from.</li>
</ul>
<h2><a class="anchor" id="autotoc_md30"></a>
3. Run from PCSX2 GUI</h2>
<p>Copy <code>SCUS_971.98</code> from the <code>out</code> dir to your PCSX2 Games folder and rename it to <code>SCUS_971.98.elf</code>. Right click on the game in PCSX2 and click "Properties...". Go to "Disc Path", click "Browse", and select the ISO of your game backup. Then click "Close" and start the game as normal.</p>
<h1><a class="anchor" id="autotoc_md31"></a>
Project Structure</h1>
<p>The project is divided into the following directories:</p>
<ul>
<li><code>include</code> - Header files for the game engine.</li>
<li><code>src</code> - The decompiled source code.<ul>
<li>All of the code for the game engine is in <code>src/P2</code>.</li>
<li>Code for the game's scripting engine is in <code>src/P2/splice</code>.</li>
</ul>
</li>
<li><code>config</code> - Config files for Splat (binary splitting tool).</li>
<li><code>scripts</code> - Utility scripts for setting up the build environment.</li>
<li><code>docs</code> - Documentation and instructions for contributing.</li>
<li><code>tools</code> - Utilities for function matching.</li>
<li><code>reference</code> - Reference files for functions and data structures.</li>
</ul>
<p>When you build the executable, the following directories will be created:</p>
<ul>
<li><code>asm</code> - Disassembled assembly code from the elf.</li>
<li><code>assets</code>- Binary data extracted from the elf.</li>
<li><code>obj</code> - Compiled object files.</li>
<li><code>out</code> - Compiled executables.</li>
</ul>
<h1><a class="anchor" id="autotoc_md32"></a>
FAQ</h1>
<h3><a class="anchor" id="autotoc_md33"></a>
What is a decompilation?</h3>
<p>When the developers created the game, they wrote source code and compiled it to assembly code that can run on the PS2. A decompilation involves reverse-engineering the assembly code to produce new, original code that compiles to matching assembly. This process leaves us with source code that is similar to and behaves the same as the source code (though not necessarily identical), which helps us understand what the programmers were thinking when they made the game.</p>
<h3><a class="anchor" id="autotoc_md34"></a>
How does it work?</h3>
<p>We use a tool called <a href="https://github.com/ethteck/splat/">Splat</a> to split the binary into assembly files representing each individual function. We then reimplement every function and data structure by writing C++ code that compiles to the same assembly code. We do not include any data or code from the original game binary in the decompilation.</p>
<h3><a class="anchor" id="autotoc_md35"></a>
Has this ever been done before?</h3>
<p>This was one the first PS2 decompilations; Several others have been started since we began in 2020. Our main inspiration was other projects such as the <a href="https://github.com/n64decomp/sm64">Super Mario 64 decomp</a> for the N64 and the <a href="https://github.com/zeldaret/botw">Breath of the Wild decomp</a> for the Wii U (the latter being more similar in scope to this project). There is also a Jak &amp; Daxter decomp/PC port called <a href="https://github.com/open-goal/jak-project">OpenGOAL</a>, though that game is 98% GOAL language rather than C/C++.</p>
<h3><a class="anchor" id="autotoc_md36"></a>
Is this a matching decomp?</h3>
<p>Yes. This was the first PS2 decompilation project that targeted the PS2 and utilized function matching, before it was even possible to produce a byte-matching executable. We have built a matching elf since July 2024. The ultimate goal is to match 100% of the game's functions.</p>
<h3><a class="anchor" id="autotoc_md37"></a>
How can I help?</h3>
<p>If you want to contribute, check out <a class="el" href="CONTRIBUTING_8md.html">CONTRIBUTING.md</a> and feel free to <a href="https://discord.gg/gh5xwfj">join our discord server</a> if you have any questions!</p>
<h1><a class="anchor" id="autotoc_md38"></a>
Star History</h1>
<p><a href="https://star-history.com/#theonlyzac/sly1&amp;Date"><img src="https://api.star-history.com/svg?repos=theonlyzac/sly1&amp;type=Date" alt="Star History Chart" class="inline"/>  </a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
